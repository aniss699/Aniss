import{r,j as e,C,d as k,W as T,B as d,X as A,c as I,s as L,Z as B,K as E,N as q}from"./index-CFf024ZK.js";import{a as g}from"./rotate-ccw-B5jk-TGF.js";import{L as z}from"./lightbulb-BlYaqzcI.js";function F({inputValue:i,onSuggestionApply:p,context:n,className:f="",disabled:h=!1}){const[b,l]=r.useState([]),[c,m]=r.useState(!1),[u,a]=r.useState(!1),[j,y]=r.useState(0),o=r.useRef();r.useEffect(()=>(o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{i.length>10&&!h?x():(l([]),a(!1))},1e3),()=>{o.current&&clearTimeout(o.current)}),[i,n]);const x=async()=>{m(!0);try{const s=await fetch("/api/ai/text-completion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:i,context:n,max_suggestions:3})});if(s.ok){const t=await s.json();l(t.suggestions||[]),a(t.suggestions?.length>0)}}catch{const t=N();l(t),a(t.length>0)}finally{m(!1)}},N=()=>{const s=[],t=i.toLowerCase();return(n?.field==="bio"||n?.field==="description")&&(i.length<50&&s.push({id:"1",type:"extension",text:i+" Avec une expérience solide dans mon domaine, je m'engage à livrer des résultats de qualité dans les délais convenus. Ma priorité est la satisfaction client et l'excellence technique.",confidence:85,reasoning:"Extension professionnelle adaptée au contexte",category:"Extension professionnelle"}),!t.includes("expérience")&&!t.includes("expertise")&&s.push({id:"2",type:"improvement",text:i+" Fort de plusieurs années d'expérience, je maîtrise les dernières technologies et méthodologies de mon secteur.",confidence:80,reasoning:"Ajout de crédibilité professionnelle",category:"Crédibilité"})),n?.field==="title"&&s.push({id:"3",type:"improvement",text:i.charAt(0).toUpperCase()+i.slice(1)+" - Solution clé en main",confidence:75,reasoning:"Titre plus accrocheur et professionnel",category:"Optimisation titre"}),(n?.category==="project"||n?.field==="project_description")&&(!t.includes("budget")&&!t.includes("délai")&&s.push({id:"4",type:"completion",text:i+" Budget flexible selon la proposition. Délais préférentiels sous 4 semaines. Ouvert aux suggestions d'amélioration.",confidence:90,reasoning:"Informations essentielles manquantes ajoutées",category:"Informations projet"}),!t.includes("livrable")&&!t.includes("résultat")&&s.push({id:"5",type:"extension",text:i+" Livrables attendus : code source documenté, tests inclus, formation si nécessaire. Suivi post-livraison garanti.",confidence:88,reasoning:"Clarification des attentes et livrables",category:"Livrables"})),s.slice(0,3)},v=s=>{switch(s){case"completion":return e.jsx(q,{className:"h-3 w-3"});case"improvement":return e.jsx(E,{className:"h-3 w-3"});case"extension":return e.jsx(B,{className:"h-3 w-3"});case"correction":return e.jsx(g,{className:"h-3 w-3"});default:return e.jsx(z,{className:"h-3 w-3"})}},w=s=>{switch(s){case"completion":return"border-blue-200 bg-blue-50";case"improvement":return"border-purple-200 bg-purple-50";case"extension":return"border-green-200 bg-green-50";case"correction":return"border-orange-200 bg-orange-50";default:return"border-gray-200 bg-gray-50"}};return!u&&!c?null:e.jsx("div",{className:`relative ${f}`,children:(u||c)&&e.jsx(C,{className:"absolute top-full left-0 right-0 z-50 mt-2 shadow-lg border-2 border-blue-200",children:e.jsxs(k,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-800",children:"Assistant IA - Suggestions de texte"})]}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>a(!1),className:"h-6 w-6",children:e.jsx(A,{className:"h-3 w-3"})})]}),c?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Génération en cours..."})]}):e.jsxs("div",{className:"space-y-3",children:[b.map((s,t)=>e.jsxs("div",{className:`border rounded-lg p-3 cursor-pointer transition-all ${w(s.type)} ${j===t?"ring-2 ring-blue-400":""}`,onClick:()=>y(t),children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[v(s.type),e.jsx(I,{variant:"outline",className:"text-xs",children:s.category}),e.jsxs("span",{className:"text-xs text-gray-500",children:[s.confidence,"% confiance"]})]})}),e.jsx("p",{className:"text-sm text-gray-700 mb-2 line-clamp-3",children:s.text}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.reasoning}),e.jsxs(d,{size:"sm",onClick:S=>{S.stopPropagation(),p(s.text),a(!1)},className:"h-7 text-xs",children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),"Appliquer"]})]})]},s.id)),e.jsx("div",{className:"border-t pt-3 mt-3",children:e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Suggestions basées sur l'IA et le contexte"}),e.jsxs(d,{variant:"ghost",size:"sm",onClick:x,className:"h-6 text-xs",children:[e.jsx(g,{className:"h-3 w-3 mr-1"}),"Actualiser"]})]})})]})]})})})}export{F as T};
